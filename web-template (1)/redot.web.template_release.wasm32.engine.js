function t(c=1){try{return!!document.createElement("canvas").getContext(["webgl","webgl2"][c-1])}catch(e){}return!1}function u(){return"fetch"in window&&"Response"in window&&"body"in window.Response.prototype}function v(){return!0===window.isSecureContext}function w(){return!0===window.crossOriginIsolated}function x(){return"SharedArrayBuffer"in window}function y(){return"AudioContext"in window&&"audioWorklet"in AudioContext.prototype}
function z(c={}){({threads:c=!0}=c);const e=[];t(2)||e.push("WebGL2 - Check web browser configuration and hardware support");u()||e.push("Fetch - Check web browser version");v()||e.push("Secure Context - Check web server configuration (use HTTPS)");c&&(w()||e.push("Cross-Origin Isolation - Check that the web server configuration sends the correct headers."),x()||e.push("SharedArrayBuffer - Check that the web server configuration sends the correct headers."));return e};function A(){function c(){let a=0,d=0,l=!0,m=!0;Object.keys(n).forEach(function(f){f=n[f];f.done||(m=!1);l&&0!==f.total?d+=f.total:(l=!1,d=0);a+=f.loaded});if(a!==p||d!==g)p=a,g=d,"function"===typeof h&&h(a,d);m||requestAnimationFrame(c)}function e(a,d){function l(f,q){return f.read().then(function(r){if(d.done)return Promise.resolve();r.value&&(q.enqueue(r.value),d.loaded+=r.value.length);if(!r.done)return l(f,q);d.done=!0;return Promise.resolve()})}const m=a.body.getReader();return new Response(new ReadableStream({start:function(f){l(m,
f).then(function(){f.close()})}}),{headers:a.headers})}function k(a,d,l,m){d[a]={total:l||0,loaded:0,done:!1};return fetch(a).then(function(f){if(!f.ok)return Promise.reject(Error(`Failed loading file '${a}'`));f=e(f,d[a]);return m?Promise.resolve(f):f.arrayBuffer()})}function b(a,d=1){return a().catch(function(l){return 1>=d?Promise.reject(l):new Promise(function(m,f){setTimeout(function(){b(a,d-1).then(m).catch(f)},1E3)})})}const n={};var p=0,g=0;let h=null;this.S=c;this.T=function(a){h=a};this.s=
function(a,d,l=!1){return b(k.bind(null,a,n,d,l),4)};this.i=[];this.B=function(a,d,l){let m=null;if("string"===typeof a){const f=this;return this.s(a,l).then(function(q){f.i.push({path:d||a,buffer:q});return Promise.resolve()})}a instanceof ArrayBuffer?m=new Uint8Array(a):ArrayBuffer.isView(a)&&(m=new Uint8Array(a.buffer));return m?(this.i.push({path:d,buffer:a}),Promise.resolve()):Promise.reject(Error("Invalid object for preloading"))}};function B(c){function e(k){this.update(k)}e.prototype={M:!0,canvas:null,m:"",D:null,locale:null,u:2,j:[],A:!0,v:!1,serviceWorker:"",L:["/userfs"],K:!1,l:[],o:[],F:null,G:null,J:null,H:function(){console.log.apply(console,Array.from(arguments))},I:function(k){console.error.apply(console,Array.from(arguments))}};e.prototype.update=function(k){function b(p,g){return"undefined"===typeof n[p]?g:n[p]}const n=k||{};this.M=b("unloadAfterInit",this.M);this.I=b("onPrintError",this.I);this.H=b("onPrint",this.H);
this.J=b("onProgress",this.J);this.canvas=b("canvas",this.canvas);this.m=b("executable",this.m);this.D=b("mainPack",this.D);this.locale=b("locale",this.locale);this.u=b("canvasResizePolicy",this.u);this.L=b("persistentPaths",this.L);this.K=b("persistentDrops",this.K);this.v=b("experimentalVK",this.v);this.A=b("focusCanvas",this.A);this.serviceWorker=b("serviceWorker",this.serviceWorker);this.l=b("gdextensionLibs",this.l);this.o=b("fileSizes",this.o);this.j=b("args",this.j);this.F=b("onExecute",this.F);
this.G=b("onExit",this.G)};e.prototype.R=function(k,b){let n=b;const p=this.l;return{print:this.H,printErr:this.I,thisProgram:this.m,noExitRuntime:!1,dynamicLibraries:[`${k}.side.wasm`].concat(this.l),instantiateWasm:function(g,h){function a(d){h(d.instance,d.module)}"undefined"!==typeof WebAssembly.instantiateStreaming?WebAssembly.instantiateStreaming(Promise.resolve(n),g).then(a):n.arrayBuffer().then(function(d){WebAssembly.instantiate(d,g).then(a)});n=null;return{}},locateFile:function(g){if(g.startsWith("godot.")||
g.startsWith("redot.")){if(g.endsWith(".worker.js"))return`${k}.worker.js`;if(g.endsWith(".audio.worklet.js"))return`${k}.audio.worklet.js`;if(g.endsWith(".audio.position.worklet.js"))return`${k}.audio.position.worklet.js`;if(g.endsWith(".js"))return`${k}.js`;if(!(g in p)){if(g.endsWith(".side.wasm"))return`${k}.side.wasm`;if(g.endsWith(".wasm"))return`${k}.wasm`}}return g}}};e.prototype.P=function(k){if(!(this.canvas instanceof HTMLCanvasElement)){var b=document.getElementsByTagName("canvas");b.length&&
b[0]instanceof HTMLCanvasElement&&(this.canvas=b[0]);if(!this.canvas)throw Error("No canvas found in page");}0>this.canvas.tabIndex&&(this.canvas.tabIndex=0);b=this.locale;b||(b=navigator.languages?navigator.languages[0]:navigator.language,b=b.split(".")[0]);b=b.replace("-","_");const n=this.G;return{canvas:this.canvas,canvasResizePolicy:this.u,locale:b,persistentDrops:this.K,virtualKeyboard:this.v,focusCanvas:this.A,onExecute:this.F,onExit:function(p){k();"function"===typeof n&&n(p)}}};return new e(c)}
;const C=function(){function c(g){this.g=new B(g);this.h=null}function e(g){c.prototype={C:function(h){if(p)return p;if(null==b){if(!h)return p=Promise.reject(Error("A base path must be provided when calling `init` and the engine is not loaded."));c.load(h,this.g.o[`${h}.wasm`])}const a=this;k.T(this.g.J);return p=function(d){return new Promise(function(l){d.then(function(m){m=new Response(m.clone().body,{headers:[["content-type","application/wasm"]]});Redot(a.g.R(n,m)).then(function(f){f.initFS(a.g.L).then(function(){a.h=
f;a.g.M&&c.i();l()})})})})}(b)},O:function(h,a){return k.B(h,a,this.g.o[h])},start:function(h){this.g.update(h);const a=this;return a.C().then(function(){if(!a.h)return Promise.reject(Error("The engine must be initialized before it can be started"));let d={};try{d=a.g.P(function(){a.h=null})}catch(l){return Promise.reject(l)}a.h.initConfig(d);return 0<a.g.l.length&&!a.h.loadDynamicLibrary?Promise.reject(Error('GDExtension libraries are not supported by this engine version. Enable "Extensions Support" for your export preset and/or build your custom template with "dlink_enabled=yes".')):
new Promise(function(l){for(const m of k.i)a.h.copyToFS(m.path,m.buffer);k.i.length=0;a.h.callMain(a.g.j);p=null;a.N();l()})})},B:function(h){this.g.update(h);h=this.g.m;const a=this.g.D||`${h}.pck`;this.g.j=["--main-pack",a].concat(this.g.j);const d=this;return Promise.all([this.C(h),this.O(a,a)]).then(function(){return d.start.apply(d)})},i:function(h,a){if(null==this.h)throw Error("Engine must be inited before copying files");this.h.copyToFS(h,a)},s:function(){this.h&&this.h.request_quit()},N:function(){return this.g.serviceWorker&&
"serviceWorker"in navigator?navigator.serviceWorker.register(this.g.serviceWorker):Promise.resolve()}};c.prototype.init=c.prototype.C;c.prototype.preloadFile=c.prototype.O;c.prototype.start=c.prototype.start;c.prototype.startGame=c.prototype.B;c.prototype.copyToFS=c.prototype.i;c.prototype.requestQuit=c.prototype.s;c.prototype.installServiceWorker=c.prototype.N;c.prototype.load=c.load;c.prototype.unload=c.i;return new c(g)}const k=new A;let b=null,n="",p=null;c.load=function(g,h){null==b&&(n=g,b=
k.s(`${n}.wasm`,h,!0),requestAnimationFrame(k.S));return b};c.i=function(){b=null};e.load=c.load;e.unload=c.i;e.isWebGLAvailable=t;e.isFetchAvailable=u;e.isSecureContext=v;e.isCrossOriginIsolated=w;e.isSharedArrayBufferAvailable=x;e.isAudioWorkletAvailable=y;e.getMissingFeatures=z;return e}();"undefined"!==typeof window&&(window.Engine=C);
